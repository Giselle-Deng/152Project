---
title: "152section"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
```

```{r}
school<-read.csv("school.csv", header= TRUE, stringsAsFactors = FALSE)
school$schid
summary(school$c0264)
table(school$c0264)
unique(school$ic0264)



data<-select(school,schid,vioinc08,c0174,c0176,c0178,c0180, c0264, finalwgt,strata)
colnames(data) = c("school_id", "num_vioninc", "prevention_train", "modification", "counseling", "mentor","train_drug","final_wt", "strata")
summary(data$modification)

data$prevention_train[data$prevention_train == 2]<-0
data$modification[data$modification == 2]<-0
data$counseling[data$counseling==2]<-0
data$mentor[data$mentor == 2] <- 0

summary(data)
nrow(data)
head(data)
data$final_wt
range(data$final_wt)
max(data$final_wt)
boxplot(data$final_wt, plot=FALSE)$out
```

```{r}
dstrat <- svydesign(id = ~1, strata = ~strata, weights = ~final_wt, data = data,nest=T)
summary(dstrat)
subdata<-subset(data,strata>200&strata<400)
dstrat2<-svydesign(id = ~1, strata = ~strata, weights = ~final_wt, data = subdata)
data$school_id

```

```{r}
svyboxplot( log(num_vioninc+2.7)~as.factor(prevention_train), dstrat, all.outliers = TRUE)
svyboxplot( log(num_vioninc+2.7)~as.factor(modification), dstrat, all.outliers = TRUE)
svyboxplot(log(num_vioninc+2.7)~as.factor(counseling), dstrat, all.outliers = TRUE)
svyboxplot( log(num_vioninc+2.7)~as.factor(mentor), dstrat, all.outliers = TRUE)
```

```{r}
svyboxplot( log(num_vioninc+2.7)~as.factor(train_drug), dstrat, all.outliers = TRUE)

ggplot(data, aes(x=as.factor(train_drug), y = log(num_vioninc + 2.7))) +
  geom_boxplot() + ggtitle("Teach or Train Students") +
  xlab("Teach or Train Students") + ylab("# of Incidents")
```










